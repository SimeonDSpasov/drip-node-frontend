import{a as G}from"./chunk-NJHQRQ2S.js";import{a as R}from"./chunk-VOBQUM4P.js";import{A as B,l as E,m as I,n as T,o as z,s as L,u as N,v as D,w as V,y as q}from"./chunk-IVAB2QGM.js";import{Ba as o,Fa as v,Ka as M,Oa as l,Rb as y,Sb as S,Tb as w,Ya as d,Za as O,ba as _,ca as h,cb as a,d as b,db as i,eb as g,fb as P,gb as x,hb as p,lb as s,mb as u,nb as k,ob as F,r as C,za as f}from"./chunk-KGVT5ALD.js";function Y(r,n){r&1&&(a(0,"span"),s(1,"Product link is required"),i())}function A(r,n){r&1&&(a(0,"span"),s(1,"Please enter a valid CNFans product link"),i())}function $(r,n){if(r&1&&(a(0,"div",9),l(1,Y,2,0,"span",10)(2,A,2,0,"span",10),i()),r&2){let t,e,c=p();o(),d("ngIf",(t=c.productForm.get("productLink"))==null||t.errors==null?null:t.errors.required),o(),d("ngIf",(e=c.productForm.get("productLink"))==null||e.errors==null?null:e.errors.pattern)}}function W(r,n){if(r&1&&(a(0,"div",11),s(1),i()),r&2){let t=p();o(),k(" ",t.error," ")}}function H(r,n){if(r&1){let t=P();a(0,"img",29),x("click",function(){let c=_(t).index,m=p(3);return h(m.selectImage(c))}),i()}if(r&2){let t=n.$implicit,e=n.index,c=p(3);O("selected",e===c.selectedImageIndex),d("src",t,f)("alt",c.productInfo.title)}}function K(r,n){if(r&1&&(a(0,"div",27),l(1,H,1,4,"img",28),i()),r&2){let t=p(2);o(),d("ngForOf",t.productInfo.imgList)}}function J(r,n){r&1&&(a(0,"div",9),s(1," Translated title is required "),i())}function Q(r,n){if(r&1&&(a(0,"div",30),g(1,"img",31),a(2,"h4"),s(3),i()()),r&2){let t=p(2);o(),d("src",t.productInfo.sellerInfo.shopLogo,f)("alt",t.productInfo.sellerInfo.shopTitle),o(2),u(t.productInfo.sellerInfo.shopTitle)}}function X(r,n){if(r&1&&(a(0,"p",36),s(1),i()),r&2){let t=p(3);o(),u(t.skuPrices[t.productInfo.skus[0].skuID].usd)}}function Z(r,n){if(r&1&&(a(0,"div",32)(1,"p",33),s(2,"Starting from:"),i(),a(3,"p",34),s(4),i(),l(5,X,2,1,"p",35),i()),r&2){let t=p(2);o(4),u(t.skuPrices[t.productInfo.skus[0].skuID].cny||t.formatCNYPrice(t.productInfo.skus[0].price)),o(),d("ngIf",t.skuPrices[t.productInfo.skus[0].skuID]==null?null:t.skuPrices[t.productInfo.skus[0].skuID].usd)}}function tt(r,n){if(r&1&&(a(0,"p",47),s(1),i()),r&2){let t=p().$implicit,e=p(3);o(),u(e.skuPrices[t.skuID].usd)}}function et(r,n){if(r&1&&(a(0,"div",39),g(1,"img",40),a(2,"div",41)(3,"h4"),s(4),i(),a(5,"p",42),s(6),i(),a(7,"div",43)(8,"p",44),s(9),i(),l(10,tt,2,1,"p",45),i(),a(11,"p",46),s(12),i()()()),r&2){let t=n.$implicit,e=p(3);o(),d("src",t.imgUrl,f)("alt",t.name),o(3),u(t.name),o(2),u(t.nameTrans),o(3),u(e.skuPrices[t.skuID].cny||e.formatCNYPrice(t.price)),o(),d("ngIf",e.skuPrices[t.skuID].usd),o(2),k("Stock: ",t.stock,"")}}function rt(r,n){if(r&1&&(a(0,"div",37),l(1,et,13,7,"div",38),i()),r&2){let t=p(2);o(),d("ngForOf",t.productInfo.skus)}}function nt(r,n){if(r&1){let t=P();a(0,"div",12)(1,"div",13)(2,"div",14),g(3,"img",15),l(4,K,2,1,"div",16),i(),a(5,"div",17)(6,"h2",18),s(7),i(),a(8,"form",19)(9,"div",2)(10,"label",20),s(11,"Translated Title:"),i(),g(12,"input",21),l(13,J,2,0,"div",5),i(),a(14,"button",22),x("click",function(){_(t);let c=p();return h(c.saveProduct())}),s(15," Save Product "),i()(),l(16,Q,4,3,"div",23)(17,Z,6,2,"div",24),a(18,"button",25),x("click",function(){_(t);let c=p();return h(c.toggleSkus())}),s(19),i()()(),l(20,rt,2,1,"div",26),i()}if(r&2){let t,e=p();o(3),d("src",e.productInfo.imgList[e.selectedImageIndex],f)("alt",e.productInfo.title),o(),d("ngIf",e.productInfo.imgList==null?null:e.productInfo.imgList.length),o(3),u(e.productInfo.title),o(),d("formGroup",e.editForm),o(5),d("ngIf",((t=e.editForm.get("titleTrans"))==null?null:t.invalid)&&((t=e.editForm.get("titleTrans"))==null?null:t.touched)),o(),d("disabled",!e.editForm.valid),o(2),d("ngIf",e.productInfo.sellerInfo),o(),d("ngIf",e.productInfo.skus==null?null:e.productInfo.skus.length),o(2),F(" ",e.showSkus?"Hide":"Show"," All SKUs (",e.productInfo.skus.length||0,") "),o(),d("ngIf",e.showSkus)}}var U=class r{constructor(n,t,e){this.fb=n;this.requestsProductService=t;this.rateService=e;this.productForm=this.fb.group({productLink:["",[I.required]]}),this.editForm=this.fb.group({titleTrans:["",I.required]}),this.rateService.getRateObservable().subscribe(c=>{c&&this.productInfo?.skus&&this.updateAllPrices(c)})}productForm;productInfo=null;error=null;skuPrices={};showSkus=!1;selectedImageIndex=0;editForm;parseProductLink(n){try{let t=n.startsWith("@")?n.substring(1):n,e=t.match(/[?&]id=(\d+)/),c=t.match(/[?&](?:platform|shop_type)=([^&]+)/i);if(e&&c){let m=e[1],j=c[1].toUpperCase();return{productId:m,platform:j}}}catch(t){console.error("Error parsing product link:",t)}return null}formatCurrency(n,t){return new Intl.NumberFormat("en-US",{style:"currency",currency:t,minimumFractionDigits:2,maximumFractionDigits:2}).format(n)}formatCNYPrice(n){return this.formatCurrency(parseFloat(n),"CNY")}toggleSkus(){this.showSkus=!this.showSkus}selectImage(n){this.selectedImageIndex=n}saveProduct(){return b(this,null,function*(){if(this.editForm.valid&&this.productInfo)try{let n=this.parseProductLink(this.productForm.get("productLink")?.value);if(!n){this.error="Invalid product link";return}let t=this.requestsProductService.saveCNFansProduct(n.productId,n.platform,{titleTrans:this.editForm.get("titleTrans")?.value});(yield C(t)).status===200?this.productInfo.titleTrans=this.editForm.get("titleTrans")?.value:this.error="Failed to save product"}catch(n){this.error="Error saving product",console.error("Error saving product:",n)}})}updateAllPrices(n){this.productInfo?.skus&&this.productInfo.skus.forEach(t=>{let e=parseFloat(t.price),c=e*n;this.skuPrices[t.skuID]={cny:this.formatCurrency(e,"CNY"),usd:this.formatCurrency(c,"USD")}})}getProductData(){return b(this,null,function*(){if(this.productForm.valid){let n=this.productForm.get("productLink")?.value,t=this.parseProductLink(n);if(!t){this.error="Invalid product link";return}this.error=null,this.showSkus=!1,this.selectedImageIndex=0;let e=this.requestsProductService.getCNFansProductDetail(t.productId,t.platform),c=yield C(e);switch(c.status){case 200:this.productInfo=c.data.data.productInfo,this.editForm.patchValue({titleTrans:this.productInfo.titleTrans});let m=this.rateService.getRate();m&&this.updateAllPrices(m);break;default:this.error="Failed to fetch product data";break}}})}static \u0275fac=function(t){return new(t||r)(v(q),v(R),v(G))};static \u0275cmp=M({type:r,selectors:[["app-product-fetcher"]],decls:11,vars:5,consts:[[1,"product-fetcher"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","productLink"],["type","text","id","productLink","formControlName","productLink","placeholder","Enter CNFans product link (e.g., https://cnfans.com/product?platform=WEIDIAN&id=123456)",1,"form-control"],["class","validation-error",4,"ngIf"],["type","submit",3,"disabled"],["class","error-message",4,"ngIf"],["class","product-info",4,"ngIf"],[1,"validation-error"],[4,"ngIf"],[1,"error-message"],[1,"product-info"],[1,"main-product"],[1,"product-images"],[1,"main-image",3,"src","alt"],["class","thumbnail-grid",4,"ngIf"],[1,"product-details"],[1,"product-title"],[1,"edit-form",3,"formGroup"],["for","titleTrans"],["type","text","id","titleTrans","formControlName","titleTrans","required","",1,"form-control"],["type","button",1,"save-button",3,"click","disabled"],["class","seller-info",4,"ngIf"],["class","main-price",4,"ngIf"],[1,"toggle-skus",3,"click"],["class","skus-grid",4,"ngIf"],[1,"thumbnail-grid"],["class","thumbnail",3,"src","alt","selected","click",4,"ngFor","ngForOf"],[1,"thumbnail",3,"click","src","alt"],[1,"seller-info"],[1,"shop-logo",3,"src","alt"],[1,"main-price"],[1,"price-label"],[1,"price-cny"],["class","price-usd",4,"ngIf"],[1,"price-usd"],[1,"skus-grid"],["class","sku-card",4,"ngFor","ngForOf"],[1,"sku-card"],[1,"sku-image",3,"src","alt"],[1,"sku-details"],[1,"sku-name-trans"],[1,"price-container"],[1,"sku-price-cny"],["class","sku-price-usd",4,"ngIf"],[1,"sku-stock"],[1,"sku-price-usd"]],template:function(t,e){if(t&1&&(a(0,"div",0)(1,"form",1),x("ngSubmit",function(){return e.getProductData()}),a(2,"div",2)(3,"label",3),s(4,"Product Link:"),i(),g(5,"input",4),l(6,$,3,2,"div",5),i(),a(7,"button",6),s(8,"Fetch Product"),i()(),l(9,W,2,1,"div",7)(10,nt,21,12,"div",8),i()),t&2){let c;o(),d("formGroup",e.productForm),o(5),d("ngIf",((c=e.productForm.get("productLink"))==null?null:c.invalid)&&((c=e.productForm.get("productLink"))==null?null:c.touched)),o(),d("disabled",!e.productForm.valid),o(2),d("ngIf",e.error),o(),d("ngIf",e.productInfo)}},dependencies:[w,y,S,B,L,E,T,z,V,N,D],styles:["[_nghost-%COMP%]{display:block;width:100%;max-width:800px;margin:0 auto;padding:2rem}.container[_ngcontent-%COMP%]{background-color:#fff;border-radius:4px;box-shadow:0 2px 4px #0000001a;padding:2rem}h2[_ngcontent-%COMP%]{color:var(--ipi-input-header-color, #0B1222);font-size:24px;font-weight:600;margin-bottom:2rem}h3[_ngcontent-%COMP%]{color:var(--ipi-input-header-color, #0B1222);font-size:18px;font-weight:600;margin-bottom:1rem}.form-label[_ngcontent-%COMP%]{color:var(--ipi-input-header-color, #0B1222);font-size:14px;font-weight:600;margin-bottom:.5rem;display:block}.form-control[_ngcontent-%COMP%]{width:100%;height:44px;padding:0 16px;border:1px solid var(--ipi-input-border-color, #E9E9E9);border-radius:4px;font-size:14px;color:var(--ipi-input-value-color, #0B1222);transition:border-color .3s ease}.form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--ipi-input-border-hover-color, #4B5368)}.form-control[_ngcontent-%COMP%]::placeholder{color:var(--ipi-input-placeholder-color, #C6C6C6)}.form-select[_ngcontent-%COMP%]{width:100%;height:44px;padding:0 16px;border:1px solid var(--ipi-input-border-color, #E9E9E9);border-radius:4px;font-size:14px;color:var(--ipi-input-value-color, #0B1222);background-color:#fff;cursor:pointer;transition:border-color .3s ease}.form-select[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--ipi-input-border-hover-color, #4B5368)}.btn-primary[_ngcontent-%COMP%]{height:44px;min-width:164px;padding:0 16px;background-color:var(--ipi-button-background-color, #0B1222);color:var(--ipi-button-text-color, #FFFFFF);border:none;border-radius:4px;font-size:14px;font-weight:600;cursor:pointer;transition:opacity .3s ease}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){opacity:.8}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}pre[_ngcontent-%COMP%]{background-color:var(--ipi-input-border-color, #E9E9E9);padding:1rem;border-radius:4px;overflow-x:auto;font-size:14px;line-height:1.5;color:var(--ipi-input-value-color, #0B1222)}.alert-danger[_ngcontent-%COMP%]{background-color:var(--ipi-snackbar-error-background-color, #F96138);color:#fff;padding:1rem;border-radius:4px;font-size:14px;margin-top:1rem}@media (max-width: 768px){[_nghost-%COMP%]{padding:1rem}.container[_ngcontent-%COMP%]{padding:1rem}h2[_ngcontent-%COMP%]{font-size:20px}h3[_ngcontent-%COMP%]{font-size:16px}}.product-fetcher[_ngcontent-%COMP%]{padding:20px;max-width:1200px;margin:0 auto}.form-group[_ngcontent-%COMP%]{margin-bottom:15px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;font-weight:500}.form-control[_ngcontent-%COMP%]{width:100%;padding:8px;border:1px solid #ddd;border-radius:4px}button[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;padding:10px 20px;border:none;border-radius:4px;cursor:pointer}button[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed}.error-message[_ngcontent-%COMP%]{color:#dc3545;margin:10px 0;padding:10px;background-color:#f8d7da;border-radius:4px}.product-info[_ngcontent-%COMP%]{margin-top:20px}.main-product[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:30px;margin-bottom:30px;background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 4px #0000001a}.product-images[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:15px}.main-image[_ngcontent-%COMP%]{width:100%;height:auto;border-radius:8px;object-fit:cover}.thumbnail-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(80px,1fr));gap:10px}.thumbnail[_ngcontent-%COMP%]{width:100%;height:80px;object-fit:cover;border-radius:4px;cursor:pointer;transition:all .2s;border:2px solid transparent}.thumbnail[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.thumbnail.selected[_ngcontent-%COMP%]{border-color:#007bff;transform:scale(1.05);box-shadow:0 2px 4px #0000001a}.product-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:15px}.product-details[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:24px;color:#333}.product-details[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:18px;color:#666}.seller-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:10px;background:#f8f9fa;border-radius:4px}.shop-logo[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;object-fit:cover}.seller-info[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;font-size:16px;color:#333}.main-price[_ngcontent-%COMP%]{margin-top:20px;padding:15px;background:#f8f9fa;border-radius:4px}.price-label[_ngcontent-%COMP%]{margin:0;font-size:14px;color:#666}.price-cny[_ngcontent-%COMP%]{margin:5px 0;font-size:24px;font-weight:700;color:#333}.price-usd[_ngcontent-%COMP%]{margin:0;font-size:24px;font-weight:700;color:#28a745}.toggle-skus[_ngcontent-%COMP%]{margin-top:20px;background-color:#6c757d;color:#fff;padding:10px 20px;border:none;border-radius:4px;cursor:pointer;transition:background-color .2s}.toggle-skus[_ngcontent-%COMP%]:hover{background-color:#5a6268}.skus-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:20px;margin-top:20px}.sku-card[_ngcontent-%COMP%]{background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 2px 4px #0000001a;transition:transform .2s}.sku-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}.sku-image[_ngcontent-%COMP%]{width:100%;height:200px;object-fit:cover}.sku-details[_ngcontent-%COMP%]{padding:15px}.sku-details[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 5px;font-size:16px;color:#333}.sku-name-trans[_ngcontent-%COMP%]{margin:0 0 10px;font-size:14px;color:#666}.price-container[_ngcontent-%COMP%]{margin:10px 0}.sku-price-cny[_ngcontent-%COMP%]{margin:0;font-size:18px;font-weight:700;color:#333}.sku-price-usd[_ngcontent-%COMP%]{margin:5px 0 0;font-size:20px;font-weight:700;color:#28a745}.sku-stock[_ngcontent-%COMP%]{margin:10px 0 0;font-size:14px;color:#666}.product-title[_ngcontent-%COMP%]{font-size:24px;font-weight:600;color:#333;margin:0 0 20px;padding-bottom:15px;border-bottom:2px solid #f0f0f0}.edit-form[_ngcontent-%COMP%]{margin-bottom:20px;background:#f8f9fa;padding:20px;border-radius:8px}.edit-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:20px}.edit-form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;font-weight:600;color:#333;font-size:16px}.edit-form[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{width:100%;padding:12px;border:2px solid #ddd;border-radius:4px;font-size:16px;transition:all .2s;background:#fff}.edit-form[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:#007bff;box-shadow:0 0 0 3px #007bff40}.edit-form[_ngcontent-%COMP%]   .form-control.ng-invalid.ng-touched[_ngcontent-%COMP%]{border-color:#dc3545}.validation-error[_ngcontent-%COMP%]{color:#dc3545;font-size:14px;margin-top:5px}.save-button[_ngcontent-%COMP%]{background-color:#28a745;color:#fff;padding:12px 24px;border:none;border-radius:4px;font-size:16px;font-weight:600;cursor:pointer;transition:all .2s;width:100%;margin-top:20px;text-transform:uppercase;letter-spacing:.5px}.save-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#218838;transform:translateY(-1px);box-shadow:0 2px 4px #0000001a}.save-button[_ngcontent-%COMP%]:disabled{background-color:#6c757d;cursor:not-allowed;opacity:.7}"]})};export{U as ProductFetcherComponent};
