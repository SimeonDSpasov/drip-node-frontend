import{a as T}from"./chunk-QJE3QTJ2.js";import{a as R}from"./chunk-NJHQRQ2S.js";import{a as G}from"./chunk-VOBQUM4P.js";import{h as w,j as F}from"./chunk-XSVUNA7Q.js";import{z as E}from"./chunk-IVAB2QGM.js";import{Ba as n,Fa as _,Ka as O,Oa as p,Rb as M,Sb as z,Tb as y,Ya as s,Za as x,ba as m,ca as f,cb as l,d as k,db as r,eb as b,fb as v,gb as h,hb as a,lb as d,mb as C,nb as g,r as I}from"./chunk-KGVT5ALD.js";function N(i,t){if(i&1){let e=v();l(0,"div",19),h("click",function(){let c=m(e).$implicit,u=a(2);return f(u.selectImage(c))}),b(1,"ipi-img",6),r()}if(i&2){let e=t.$implicit,o=a(2);x("active",o.selectedImage===e),n(),s("src",e)("ariaLabel",o.productInfo.title)}}function V(i,t){if(i&1&&(l(0,"div",22),d(1),r()),i&2){let e,o=a(3);n(),g(" ",(e=o.getSelectedColorGroup())==null?null:e.singleSkuPrice," ")}}function A(i,t){if(i&1&&(l(0,"div",20),d(1),p(2,V,2,1,"div",21),r()),i&2){let e,o=a(2);n(),g(" ",o.selectedColor," "),n(),s("ngIf",(e=o.getSelectedColorGroup())==null?null:e.isSingleSku)}}function D(i,t){if(i&1&&(l(0,"div",26),d(1),r()),i&2){let e=a().$implicit,o=a(2);n(),g(" ",o.getFormattedPrice(e.sizes[0].sku.price)," ")}}function U(i,t){if(i&1){let e=v();l(0,"button",23),h("click",function(){let c=m(e).$implicit,u=a(2);return f(u.selectColor(c.color))}),l(1,"div",24),b(2,"ipi-img",6),r(),p(3,D,2,1,"div",25),r()}if(i&2){let e=t.$implicit,o=a(2);x("selected",o.selectedColor===e.color),n(2),s("src",e.colorImage)("ariaLabel",e.color),n(),s("ngIf",e.isSingleSku&&e.sizes.length>0)}}function j(i,t){if(i&1){let e=v();l(0,"button",31),h("click",function(){let c=m(e).$implicit,u=a(4);return f(u.selectSize(c.size))}),l(1,"span",32),d(2),r(),l(3,"span",33),d(4),r()()}if(i&2){let e=t.$implicit,o=a(4);x("selected",o.selectedSize===e.size)("unavailable",e.stock<=0),s("disabled",e.stock<=0),n(2),C(e.size),n(2),C(o.getFormattedPrice(e.sku.price))}}function B(i,t){if(i&1&&(l(0,"div",29),p(1,j,5,7,"button",30),r()),i&2){let e=a(3);n(),s("ngForOf",e.getSizesForSelectedColor())}}function $(i,t){if(i&1&&(l(0,"div",37),d(1),r()),i&2){let e=a(4);n(),g(" ",e.getSingleSkuPrice()," ")}}function q(i,t){if(i&1&&(l(0,"div",34)(1,"div",35),d(2,"\u0420\u0430\u0437\u043C\u0435\u0440 \u043D\u0435 \u0435 \u043D\u0430\u043B\u0438\u0447\u0435\u043D \u0437\u0430 \u0442\u043E\u0437\u0438 \u0446\u0432\u044F\u0442"),r(),p(3,$,2,1,"div",36),r()),i&2){let e=a(3);n(3),s("ngIf",e.getSingleSkuPrice())}}function K(i,t){if(i&1&&(l(0,"div",13)(1,"h3"),d(2,"\u0420\u0430\u0437\u043C\u0435\u0440"),r(),p(3,B,2,1,"div",27)(4,q,4,1,"div",28),r()),i&2){let e=a(2);n(3),s("ngIf",!e.isSingleSkuForSelectedColor()),n(),s("ngIf",e.isSingleSkuForSelectedColor())}}function Y(i,t){if(i&1){let e=v();l(0,"div",3)(1,"div",4)(2,"div",5),b(3,"ipi-img",6),r(),l(4,"div",7),p(5,N,2,4,"div",8),r()(),l(6,"div",9)(7,"h1",10),d(8),r(),l(9,"p",11),d(10),r(),l(11,"div",12)(12,"div",13)(13,"h3"),d(14,"\u0426\u0432\u044F\u0442"),r(),p(15,A,3,2,"div",14),l(16,"div",15),p(17,U,4,5,"button",16),r()(),p(18,K,5,2,"div",17),r(),l(19,"button",18),h("click",function(){m(e);let c=a();return f(c.addToCart())}),d(20),r()()()}if(i&2){let e=a();n(3),s("src",e.selectedImage)("ariaLabel",e.productInfo.title),n(2),s("ngForOf",e.productInfo.imgList),n(3),C((e.savedProduct==null?null:e.savedProduct.title)||(e.productInfo==null?null:e.productInfo.title)),n(2),C(e.selectedSkuPrice),n(5),s("ngIf",e.selectedColor),n(2),s("ngForOf",e.colorGroups),n(),s("ngIf",e.selectedColor),n(),s("disabled",e.selectedSkuStock<=0),n(),g(" ",e.selectedSkuStock<=0?"\u0418\u0437\u0431\u0435\u0440\u0438 \u043C\u043E\u0434\u0435\u043B":"\u0414\u043E\u0431\u0430\u0432\u0438 \u0432 \u043A\u043E\u043B\u0438\u0447\u043A\u0430"," ")}}function W(i,t){i&1&&(l(0,"div",38),d(1,` Loading product...
`),r())}function H(i,t){if(i&1&&(l(0,"div",39),d(1),r()),i&2){let e=a();n(),g(" ",e.error,`
`)}}var L=class i{constructor(t,e,o,c){this.route=t;this.router=e;this.requestsProductService=o;this.rateService=c;this.subscription=this.rateService.getRateObservable().subscribe(u=>{this.currentRate=u,this.productInfo&&this.updateSelectedSku()})}productInfo=null;savedProduct=null;selectedImage="";selectedSize="";selectedColor="";selectedType="";isLoading=!0;error=null;availableColors=[];availableSizes=[];availableTypes=[];colorGroups=[];selectedSkuPrice="";selectedSkuStock=0;currentRate=null;selection=null;subscription;ngOnInit(){this.loadProduct()}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}loadProduct(){return k(this,null,function*(){try{this.isLoading=!0,this.error=null;let t=this.route.snapshot.paramMap.get("id");if(!t){this.error="No product ID provided";return}let o=this.requestsProductService.getFinishedProduct(t,"WEIDIAN"),c=yield I(o);if(c.status===200&&c.data?.data){let{productInfo:u}=c.data.data,{savedProduct:P}=c.data;this.productInfo=u,this.savedProduct=P,console.log(this.savedProduct),this.productInfo.imgList?.length>0&&(this.selectedImage=this.productInfo.imgList[0]),this.updateAvailableOptions(),this.groupSkusByColor(),this.updateSelectedSku()}else this.error="Failed to load product"}catch(t){console.error("Error loading product:",t),this.error="Error loading product"}finally{this.isLoading=!1}})}groupSkusByColor(){if(!this.productInfo?.skus)return;let t=new Map;this.productInfo.skus.forEach(e=>{if(!e.imgUrl)return;if(!t.has(e.imgUrl)){let u=this.extractColorName(e.nameTrans)||"Color "+(t.size+1);t.set(e.imgUrl,{color:u,colorImage:e.imgUrl,sizes:[],isSingleSku:!1})}let o=t.get(e.imgUrl),c=this.extractSize(e.nameTrans);c?o.sizes.push({size:c,sku:e,stock:e.stock}):(o.isSingleSku=!0,o.singleSkuPrice=this.getFormattedPrice(e.price))}),this.colorGroups=Array.from(t.values()),console.log("Color groups:",this.colorGroups)}extractColorName(t){try{let o=t.split(";").find(c=>c.toLowerCase().includes("colour:"));if(o)return o.split(":")[1].trim()}catch(e){console.warn("Error extracting color name:",e)}return null}extractSize(t){try{let o=t.split(";").find(c=>c.toLowerCase().includes("size:"));if(o)return o.split(":")[1].trim()}catch(e){console.warn("Error extracting size:",e)}return null}updateAvailableOptions(){if(!this.productInfo?.productAttr)return;this.productInfo.productAttr.forEach(e=>{e.attr.toLowerCase().includes("color")?this.availableColors=e.values.map(o=>o.value):e.attr.toLowerCase().includes("size")?this.availableSizes=e.values.map(o=>o.value):e.attr.toLowerCase().includes("type")&&(this.availableTypes=e.values.map(o=>o.value))}),this.availableColors.length>0&&(this.selectedColor=this.availableColors[0]),this.availableSizes.length>0&&(this.selectedSize=this.availableSizes[0]),this.availableTypes.length>0&&(this.selectedType=this.availableTypes[0])}updateSelectedSku(){if(!this.productInfo?.skus)return;let t=this.productInfo.skus.find(e=>{let o=this.productInfo?.skuPropNamesMap,c=this.productInfo?.skuPropValsMap;if(!o||!c)return!1;let u=e.propsID.split(";").map(S=>c[S]),P=u.includes(this.selectedColor);return this.colorGroups.find(S=>S.color===this.selectedColor)?.isSingleSku?P:P&&u.includes(this.selectedSize)});if(t){let e=parseFloat(t.price);this.currentRate?this.selectedSkuPrice=(e*this.currentRate).toFixed(2)+" BGN":this.selectedSkuPrice=e.toFixed(2)+" CNY",this.selectedSkuStock=t.stock,t.imgUrl&&(this.selectedImage=t.imgUrl),this.selection={productInfo:this.productInfo,savedProduct:this.savedProduct,selectedSku:t,selectedColor:this.selectedColor,selectedSize:this.selectedSize,price:{original:t.price,converted:this.selectedSkuPrice},image:t.imgUrl},console.log("Current selection:",this.selection)}}selectImage(t){this.selectedImage=t}selectSize(t){this.selectedSize=t,this.updateSelectedSku()}selectColor(t){this.selectedColor=t;let e=this.colorGroups.find(o=>o.color===t);e?.colorImage&&(this.selectedImage=e.colorImage),this.updateSelectedSku()}selectType(t){this.selectedType=t,this.updateSelectedSku()}addToCart(){if(!this.selection||!this.selection.selectedSku){alert("Please select all options before adding to cart");return}if(!this.colorGroups.find(e=>e.color===this.selectedColor)?.isSingleSku&&!this.selectedSize){alert("Please select a size before adding to cart");return}if(this.selection.selectedSku.stock<=0){alert("This item is out of stock");return}console.log("Adding to cart:",this.selection)}onProductClick(t){this.router.navigate(["/product",t.id])}getSizesForSelectedColor(){return this.colorGroups.find(e=>e.color===this.selectedColor)?.sizes||[]}getFormattedPrice(t){let e=parseFloat(t);return this.currentRate?(e*this.currentRate).toFixed(2)+" BGN":e.toFixed(2)+" CNY"}isSingleSkuForSelectedColor(){return this.colorGroups.find(e=>e.color===this.selectedColor)?.isSingleSku||!1}getSingleSkuPrice(){if(!this.selectedColor)return null;let t=this.colorGroups.find(o=>o.color===this.selectedColor);if(!t?.isSingleSku||t.sizes.length===0)return null;let e=t.sizes[0].sku;return this.getFormattedPrice(e.price)}getSelectedColorGroup(){return this.colorGroups.find(t=>t.color===this.selectedColor)}static \u0275fac=function(e){return new(e||i)(_(w),_(F),_(G),_(R))};static \u0275cmp=O({type:i,selectors:[["app-product-page"]],decls:3,vars:3,consts:[["class","product-page",4,"ngIf"],["class","loading",4,"ngIf"],["class","error",4,"ngIf"],[1,"product-page"],[1,"product-gallery"],[1,"main-image"],[3,"src","ariaLabel"],[1,"thumbnail-images"],["class","thumbnail",3,"active","click",4,"ngFor","ngForOf"],[1,"product-details"],[1,"product-title"],[1,"product-price"],[1,"product-options"],[1,"option-group"],["class","selected-color-name",4,"ngIf"],[1,"color-buttons"],["class","color-button",3,"selected","click",4,"ngFor","ngForOf"],["class","option-group",4,"ngIf"],[1,"add-to-cart-button",3,"click","disabled"],[1,"thumbnail",3,"click"],[1,"selected-color-name"],["class","selected-color-price",4,"ngIf"],[1,"selected-color-price"],[1,"color-button",3,"click"],[1,"color-image"],["class","color-price",4,"ngIf"],[1,"color-price"],["class","option-buttons",4,"ngIf"],["class","single-sku-info",4,"ngIf"],[1,"option-buttons"],["class","option-button size-button",3,"selected","unavailable","disabled","click",4,"ngFor","ngForOf"],[1,"option-button","size-button",3,"click","disabled"],[1,"size"],[1,"price"],[1,"single-sku-info"],[1,"single-sku-message"],["class","single-sku-price",4,"ngIf"],[1,"single-sku-price"],[1,"loading"],[1,"error"]],template:function(e,o){e&1&&p(0,Y,21,10,"div",0)(1,W,2,0,"div",1)(2,H,2,1,"div",2),e&2&&(s("ngIf",!o.isLoading&&!o.error&&o.productInfo),n(),s("ngIf",o.isLoading),n(),s("ngIf",o.error))},dependencies:[y,M,z,E,T],styles:[".product-page[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:2rem;padding:2rem;max-width:1200px;margin:0 auto}.product-gallery[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.main-image[_ngcontent-%COMP%]{width:600px;height:600px;position:relative;border:1px solid black;overflow:hidden}.main-image[_ngcontent-%COMP%]   ipi-img[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover}.thumbnail-images[_ngcontent-%COMP%]{width:600px;display:flex;gap:1rem;overflow-x:auto;padding:1rem}.thumbnail[_ngcontent-%COMP%]{width:80px;padding-top:80px;position:relative;border:1px solid black;cursor:pointer;overflow:hidden;flex-shrink:0}.thumbnail.active[_ngcontent-%COMP%]{border-color:#000;border-width:2px}.thumbnail[_ngcontent-%COMP%]   ipi-img[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover}.product-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.product-title[_ngcontent-%COMP%]{margin:0;font-size:2rem;font-weight:400}.product-price[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;font-weight:700}.product-description[_ngcontent-%COMP%]{font-size:1.1rem;line-height:1.5}.product-options[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.option-group[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.2rem;font-weight:400}.option-buttons[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}.option-button[_ngcontent-%COMP%]{padding:.5rem 1rem;border:1px solid black;background:none;cursor:pointer;transition:all .3s ease}.option-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#000;color:#fff}.option-button.selected[_ngcontent-%COMP%]{background-color:#000;color:#fff}.option-button.unavailable[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed}.add-to-cart-button[_ngcontent-%COMP%]{padding:1rem 2rem;border:1px solid black;background:none;font-size:1.2rem;cursor:pointer;transition:all .3s ease;margin-top:1rem}.add-to-cart-button[_ngcontent-%COMP%]:hover{background-color:#000;color:#fff}.color-groups[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.color-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;padding:1rem;border:1px solid #e0e0e0;border-radius:8px}.color-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.color-image[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:4px;overflow:hidden;border:1px solid #e0e0e0}.color-image[_ngcontent-%COMP%]   ipi-img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.color-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.1rem;font-weight:500}.size-buttons[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}.size-buttons[_ngcontent-%COMP%]   .option-button[_ngcontent-%COMP%]{min-width:60px;text-align:center}.color-buttons[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(60px,1fr));gap:.5rem;margin-top:.5rem}.color-button[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:.25rem;border:1px solid #e0e0e0;background:none;cursor:pointer;transition:all .3s ease;border-radius:4px;aspect-ratio:1;position:relative}.color-button[_ngcontent-%COMP%]:hover:not(:disabled){border-color:#000;transform:translateY(-2px)}.color-button.selected[_ngcontent-%COMP%]{border-color:#000;border-width:2px}.color-button[_ngcontent-%COMP%]   .color-image[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:2px;overflow:hidden}.color-button[_ngcontent-%COMP%]   .color-image[_ngcontent-%COMP%]   ipi-img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.color-price[_ngcontent-%COMP%]{position:absolute;bottom:-1.5rem;left:50%;transform:translate(-50%);font-size:.8rem;color:#666;white-space:nowrap;background-color:#fff;padding:.1rem .3rem;border-radius:3px;box-shadow:0 1px 3px #0000001a}.color-button.selected[_ngcontent-%COMP%]   .color-price[_ngcontent-%COMP%]{color:#333;font-weight:500}.selected-color-name[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:500;color:#333;margin-bottom:.5rem;padding:.5rem;background-color:#f5f5f5;border-radius:4px;text-align:center;display:flex;flex-direction:column;gap:.5rem}.selected-color-price[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:600;color:#2c3e50;padding-top:.25rem;border-top:1px solid #e0e0e0}.size-button[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:.25rem;min-width:80px;padding:.5rem}.size-button[_ngcontent-%COMP%]   .size[_ngcontent-%COMP%]{font-weight:500}.size-button[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{font-size:.9rem;color:#666}.size-button.selected[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{color:#fff}.single-sku-info[_ngcontent-%COMP%]{margin-top:1rem;padding:1rem;background-color:#f8f9fa;border-radius:8px;text-align:center}.single-sku-price[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:#2c3e50;margin-top:.5rem}@media (max-width: 768px){.product-page[_ngcontent-%COMP%]{grid-template-columns:1fr;padding:1rem}}"]})};export{L as ProductPageComponent};
