import './polyfills.server.mjs';
import{a as $}from"./chunk-UHHP2HGX.mjs";import{b as L,h as z,j as D,n as W,p as Q,v as E}from"./chunk-FHVB4RTP.mjs";import{$ as x,Aa as d,Ea as C,Ja as v,Na as p,Za as m,_,db as o,eb as i,fb as y,fc as F,gb as M,gc as V,hb as g,hc as R,ib as l,mb as c,n as N,nb as k,ob as h,pb as q,qb as I,rb as O,sb as w,ya as T}from"./chunk-MZTDPML7.mjs";import{a as P,b,g as f}from"./chunk-X2SEQXRR.mjs";function A(r,n){if(r&1&&(o(0,"div",9),c(1),i()),r&2){let e=l();d(),q(" Found ",e.filteredResults.length,' items matching "',e.searchQuery,'" ')}}function U(r,n){if(r&1){let e=M();o(0,"div",27)(1,"button",28),g("click",function(a){_(e);let s=l().$implicit,u=l(4);return x(u.previousImage(s.id,a))}),o(2,"span",29),c(3,"\u2190"),i()(),o(4,"button",30),g("click",function(a){_(e);let s=l().$implicit,u=l(4);return x(u.nextImage(s.id,a))}),o(5,"span",29),c(6,"\u2192"),i()()()}}function Y(r,n){if(r&1){let e=M();o(0,"div",31)(1,"div",32)(2,"span",33),c(3,"Redeem Code:"),i(),o(4,"span",34),c(5),i()(),o(6,"button",35),g("click",function(a){_(e);let s=l().$implicit,u=l(4);return x(u.copyRedeemCode(s.redeemCode,a))}),c(7," Copy "),i()()}if(r&2){let e=l().$implicit;d(5),k(e.redeemCode)}}function G(r,n){if(r&1){let e=M();o(0,"div",16),g("click",function(){let a=_(e).$implicit,s=l(4);return x(s.getItemDetails(a.id))}),o(1,"div",17),y(2,"img",18),p(3,U,7,0,"div",19),i(),o(4,"div",20)(5,"div",21),c(6),i(),o(7,"h4"),c(8),i(),o(9,"div",22)(10,"p",23)(11,"span",24),c(12,"CNY Price:"),i(),o(13,"span",25),c(14),i()(),o(15,"p",23)(16,"span",24),c(17,"USD Price:"),i(),o(18,"span",25),c(19),i()()(),p(20,Y,8,1,"div",26),i()()}if(r&2){let e=n.$implicit,t=l(4);d(2),m("src",t.getCurrentImage(e.id,e.firstImage),T),d(),m("ngIf",t.hasMultipleImages(e.id)),d(3),h("",e.pointPrice," points"),d(2),k(e.itemNameEn),d(6),h("\xA5",(e.pointPrice/200).toFixed(2),""),d(5),h("$",(e.pointPrice/200*.14).toFixed(2),""),d(),m("ngIf",e.redeemCode)}}function J(r,n){if(r&1&&(o(0,"div",14),p(1,G,21,7,"div",15),i()),r&2){let e=l().$implicit;d(),m("ngForOf",e.data.data.list)}}function K(r,n){if(r&1&&(o(0,"div",12)(1,"p"),c(2),i(),p(3,J,2,1,"div",13),i()),r&2){let e=n.$implicit;d(2),q("Page ",e.pageNo,": ",(e.data==null||e.data.data==null||e.data.data.list==null?null:e.data.data.list.length)||0," items"),d(),m("ngIf",e.data==null||e.data.data==null?null:e.data.data.list)}}function X(r,n){if(r&1&&(o(0,"div",10)(1,"h3"),c(2,"Results:"),i(),p(3,K,4,3,"div",11),i()),r&2){let e=l();d(3),m("ngForOf",e.filteredResults)}}var S=class r{constructor(n){this.http=n}startNumber=1;endNumber=800;isLoading=!1;results=[];searchQuery="";filteredResults=[];selectedItemImages=new Map;makeRequests(){return f(this,null,function*(){this.isLoading=!0,this.results=[],this.filteredResults=[],this.selectedItemImages.clear();let n=Math.ceil(this.startNumber/20),e=Math.ceil(this.endNumber/20);console.log(`Fetching pages from ${n} to ${e}`);for(let t=n;t<=e;t++)try{let a=yield this.http.get(`https://haulfans.com/buffet/open/redeem/mall/list-items?subCategory=&category=&shopType=&redeemStatus=Redeemable&itemNameEn=&itemPropertiesEn=&maxPoint=&minPoint=&pageNo=${t}&pageSize=20`).toPromise();a?.data?.list&&this.results.push({pageNo:t,data:a})}catch(a){console.error(`Error fetching page ${t}:`,a),this.results.push({pageNo:t,error:!0})}this.filteredResults=[...this.results],this.isLoading=!1})}filterProducts(){if(!this.searchQuery.trim()){this.filteredResults=[...this.results];return}try{let n=new RegExp(this.searchQuery,"i");this.filteredResults=this.results.map(e=>{if(!e.data?.data?.list)return e;let t=e.data.data.list.filter(a=>n.test(a.itemNameEn||""));return b(P({},e),{data:b(P({},e.data),{data:b(P({},e.data.data),{list:t})})})}).filter(e=>e.data?.data?.list?.length>0)}catch(n){console.error("Invalid regex pattern:",n),this.filteredResults=[...this.results]}}getItemDetails(n){return f(this,null,function*(){try{let e=yield this.http.get(`https://haulfans.com/buffet/open/redeem/mall/item-details?id=${n}`).toPromise();e?.data&&(this.results.forEach(t=>{if(t.data?.data?.list){let a=t.data.data.list.find(s=>s.id===n);if(a){a.redeemCode=e.data.redeemCode;let s=[a.firstImage,...e.data.inboundImages||[]].filter(Boolean);console.log("Setting images for item",n,s),this.selectedItemImages.set(n,{images:s,currentIndex:0})}}}),this.filterProducts())}catch(e){console.error("Error fetching item details:",e)}})}getCurrentImage(n,e){let t=this.selectedItemImages.get(n);return t&&t.images.length>0?t.images[t.currentIndex]:e}nextImage(n,e){e.stopPropagation();let t=this.selectedItemImages.get(n);t&&t.images.length>0&&(t.currentIndex=(t.currentIndex+1)%t.images.length,this.selectedItemImages.set(n,t),console.log("Next image for item",n,"new index:",t.currentIndex))}previousImage(n,e){e.stopPropagation();let t=this.selectedItemImages.get(n);t&&t.images.length>0&&(t.currentIndex=(t.currentIndex-1+t.images.length)%t.images.length,this.selectedItemImages.set(n,t),console.log("Previous image for item",n,"new index:",t.currentIndex))}hasMultipleImages(n){let e=this.selectedItemImages.get(n);return e?e.images.length>1:!1}copyRedeemCode(n,e){e.stopPropagation(),navigator.clipboard.writeText(n).then(()=>{let t=e.target,a=t.textContent;t.textContent="Copied!",t.classList.add("copied"),setTimeout(()=>{t.textContent=a,t.classList.remove("copied")},2e3)}).catch(t=>{console.error("Failed to copy text: ",t)})}static \u0275fac=function(e){return new(e||r)(C(L))};static \u0275cmp=v({type:r,selectors:[["app-pagination-request"]],decls:10,vars:7,consts:[[1,"pagination-request"],[1,"search-section"],["type","text","placeholder","Search products (supports regex patterns)",1,"search-input",3,"ngModelChange","input","ngModel"],["class","search-info",4,"ngIf"],[1,"input-group"],["type","number","placeholder","Start number",1,"number-input",3,"ngModelChange","ngModel"],["type","number","placeholder","End number",1,"number-input",3,"ngModelChange","ngModel"],[1,"request-button",3,"click","disabled"],["class","results",4,"ngIf"],[1,"search-info"],[1,"results"],["class","result-item",4,"ngFor","ngForOf"],[1,"result-item"],["class","items-grid",4,"ngIf"],[1,"items-grid"],["class","item-card",3,"click",4,"ngFor","ngForOf"],[1,"item-card",3,"click"],[1,"image-container"],["alt","Product image",1,"item-image",3,"src"],["class","image-navigation",4,"ngIf"],[1,"item-details"],[1,"points-price"],[1,"price-details"],[1,"price-item"],[1,"price-label"],[1,"price-value"],["class","redeem-code-section",4,"ngIf"],[1,"image-navigation"],[1,"nav-button","prev",3,"click"],[1,"arrow"],[1,"nav-button","next",3,"click"],[1,"redeem-code-section"],[1,"redeem-code"],[1,"code-label"],[1,"code-value"],[1,"copy-button",3,"click"]],template:function(e,t){e&1&&(o(0,"div",0)(1,"div",1)(2,"input",2),w("ngModelChange",function(s){return O(t.searchQuery,s)||(t.searchQuery=s),s}),g("input",function(){return t.filterProducts()}),i(),p(3,A,2,2,"div",3),i(),o(4,"div",4)(5,"input",5),w("ngModelChange",function(s){return O(t.startNumber,s)||(t.startNumber=s),s}),i(),o(6,"input",6),w("ngModelChange",function(s){return O(t.endNumber,s)||(t.endNumber=s),s}),i(),o(7,"button",7),g("click",function(){return t.makeRequests()}),c(8),i()(),p(9,X,4,1,"div",8),i()),e&2&&(d(2),I("ngModel",t.searchQuery),d(),m("ngIf",t.searchQuery),d(2),I("ngModel",t.startNumber),d(),I("ngModel",t.endNumber),d(),m("disabled",t.isLoading),d(),h(" ",t.isLoading?"Loading...":"Make Requests"," "),d(),m("ngIf",t.results.length>0))},dependencies:[R,F,V,E,z,Q,D,W],styles:[".pagination-request[_ngcontent-%COMP%]{padding:20px;max-width:1200px;margin:0 auto}.search-section[_ngcontent-%COMP%]{margin-bottom:20px}.search-input[_ngcontent-%COMP%]{width:100%;padding:12px;font-size:16px;border:2px solid #ddd;border-radius:8px;transition:border-color .2s ease}.search-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#007bff;box-shadow:0 0 0 3px #007bff1a}.search-info[_ngcontent-%COMP%]{margin-top:8px;color:#666;font-size:14px}.input-group[_ngcontent-%COMP%]{display:flex;gap:10px;margin-bottom:20px}.number-input[_ngcontent-%COMP%]{padding:8px;border:1px solid #ccc;border-radius:4px;flex:1}.request-button[_ngcontent-%COMP%]{padding:8px 16px;background-color:#007bff;color:#fff;border:none;border-radius:4px;cursor:pointer}.request-button[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed}.results[_ngcontent-%COMP%]{margin-top:20px}.result-item[_ngcontent-%COMP%]{padding:20px;border:1px solid #eee;margin-bottom:20px;border-radius:8px}.items-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:20px;margin-top:15px}.item-card[_ngcontent-%COMP%]{border:1px solid #ddd;border-radius:8px;overflow:hidden;background:#fff;box-shadow:0 2px 4px #0000001a;cursor:pointer;transition:transform .2s ease-in-out}.item-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 8px #00000026}.image-container[_ngcontent-%COMP%]{position:relative;width:100%;padding-top:133.33%;overflow:hidden}.item-image[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;transition:transform .3s ease}.image-navigation[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;justify-content:space-between;align-items:center;padding:0 10px;opacity:0;transition:opacity .2s ease;background:#0000001a}.image-container[_ngcontent-%COMP%]:hover   .image-navigation[_ngcontent-%COMP%]{opacity:1}.nav-button[_ngcontent-%COMP%]{background:#00000080;border:none;border-radius:50%;width:36px;height:36px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:background-color .2s ease;z-index:2}.nav-button[_ngcontent-%COMP%]:hover{background:#000000b3}.arrow[_ngcontent-%COMP%]{color:#fff;font-size:20px;line-height:1}.item-details[_ngcontent-%COMP%]{padding:15px}.points-price[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:#28a745;margin-bottom:10px}.item-details[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 10px;font-size:16px;color:#333}.price-details[_ngcontent-%COMP%]{background:#f8f9fa;padding:10px;border-radius:4px;margin:10px 0}.price-item[_ngcontent-%COMP%]{margin:5px 0;display:flex;justify-content:space-between;align-items:center}.price-label[_ngcontent-%COMP%]{color:#666;font-size:14px}.price-value[_ngcontent-%COMP%]{font-weight:600;color:#333}.shop-name[_ngcontent-%COMP%]{margin:5px 0;color:#666;font-size:14px;font-style:italic}.redeem-code-section[_ngcontent-%COMP%]{margin-top:15px;padding:10px;background:#e8f5e9;border-radius:4px;border:1px solid #c8e6c9}.redeem-code[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin-bottom:10px}.code-label[_ngcontent-%COMP%]{font-weight:600;color:#2e7d32}.code-value[_ngcontent-%COMP%]{font-family:monospace;font-size:16px;color:#1b5e20;background:#fff;padding:4px 8px;border-radius:4px;border:1px solid #c8e6c9}.copy-button[_ngcontent-%COMP%]{width:100%;padding:8px;background-color:#2e7d32;color:#fff;border:none;border-radius:4px;cursor:pointer;transition:background-color .2s ease}.copy-button[_ngcontent-%COMP%]:hover{background-color:#1b5e20}.copy-button.copied[_ngcontent-%COMP%]{background-color:#4caf50}"]})};var j=class r{constructor(n){this.requestsProductService=n}products=[];currentPage=1;itemsPerPage=10;totalItems=0;itemsPerPageOptions=[10,20,50,100];ngOnInit(){this.loadProducts()}loadProducts(){return f(this,null,function*(){try{let n=(this.currentPage-1)*this.itemsPerPage,e=this.requestsProductService.getProductsChunk(n,this.itemsPerPage),t=yield N(e);t.status===200&&(this.products=t.data.products,this.totalItems=t.data.total)}catch(n){console.error("Error loading products:",n)}})}onPageChange(n){this.currentPage=n,this.loadProducts()}onItemsPerPageChange(n){this.itemsPerPage=n,this.currentPage=1,this.loadProducts()}get totalPages(){return Math.ceil(this.totalItems/this.itemsPerPage)}static \u0275fac=function(e){return new(e||r)(C($))};static \u0275cmp=v({type:r,selectors:[["app-products-page"]],decls:2,vars:0,consts:[[1,"products-page"]],template:function(e,t){e&1&&(o(0,"div",0),y(1,"app-pagination-request"),i())},dependencies:[R,E,S],styles:[".products-page[_ngcontent-%COMP%]{padding:2rem;max-width:1200px;margin:0 auto}.products-controls[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;padding:0 1rem}.total-items[_ngcontent-%COMP%]{font-size:1.1rem;color:#666}.items-per-page[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.items-per-page-select[_ngcontent-%COMP%]{border:1px solid black;padding:.5rem;background-color:#fff;cursor:pointer}.products-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:2rem;margin-bottom:2rem;padding:0 1rem}@media (max-width: 768px){.products-page[_ngcontent-%COMP%]{padding:1rem}.products-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:1rem;padding:0}.products-controls[_ngcontent-%COMP%]{flex-direction:column;gap:1rem;align-items:flex-start}}"]})};export{j as ProductsPageComponent};
